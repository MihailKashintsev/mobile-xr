<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Mobile XR" />
  <title>Mobile XR</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none}
    #app{width:100vw;height:100vh}
    canvas{display:block;width:100%!important;height:100%!important}

    /* –ü–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ */
    #portrait-lock{
      display:none;position:fixed;inset:0;z-index:9999;
      background:#0a0a1a;flex-direction:column;align-items:center;justify-content:center;
      color:#fff;font-family:-apple-system,sans-serif;text-align:center;padding:32px;
    }
    .p-icon{font-size:4rem;margin-bottom:20px;animation:spin 2s ease-in-out infinite}
    @keyframes spin{0%,100%{transform:rotate(0)}50%{transform:rotate(90deg)}}
    .p-title{font-size:1.2rem;font-weight:700;margin-bottom:8px}
    .p-sub{font-size:.85rem;color:#6b7280}

    /* –ó–∞–≥—Ä—É–∑–∫–∞ */
    #loading-screen{
      position:fixed;inset:0;background:#0a0a1a;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      z-index:1000;transition:opacity .5s;font-family:-apple-system,sans-serif;color:#fff;
    }
    #loading-screen.hidden{opacity:0;pointer-events:none}
    .loader-logo{font-size:3rem;margin-bottom:16px}
    .loader-title{font-size:1.5rem;font-weight:700;letter-spacing:.1em}
    .loader-sub{font-size:.85rem;color:#6b7280;margin-top:8px;min-height:1.4em;text-align:center;max-width:280px}
    .loader-bar{width:200px;height:3px;background:#1f2937;border-radius:99px;margin-top:32px;overflow:hidden}
    .loader-fill{height:100%;width:0;background:linear-gradient(90deg,#6366f1,#06b6d4);border-radius:99px;transition:width .3s}

    /* –ë–∞–Ω–Ω–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
    #update-banner{
      position:fixed;bottom:24px;left:50%;transform:translateX(-50%);
      background:rgba(99,102,241,.95);backdrop-filter:blur(12px);
      color:#fff;padding:12px 20px;border-radius:12px;
      display:none;align-items:center;gap:12px;
      font-family:-apple-system,sans-serif;font-size:.85rem;z-index:9999;
      box-shadow:0 8px 32px rgba(99,102,241,.4);white-space:nowrap;
    }
    #update-banner.show{display:flex}
    #update-btn{background:#fff;color:#6366f1;border:none;padding:6px 14px;border-radius:8px;font-weight:700;cursor:pointer;font-size:.85rem}
    #dismiss-btn{background:transparent;border:none;color:rgba(255,255,255,.7);cursor:pointer;font-size:1.1rem;padding:0 4px}

    /* HUD */
    #hud{
      position:fixed;top:env(safe-area-inset-top,10px);left:0;right:0;
      display:flex;justify-content:space-between;align-items:center;
      padding:8px 14px;z-index:100;pointer-events:none;
    }
    .hud-badge{
      background:rgba(10,10,26,.65);backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,.1);border-radius:20px;
      padding:6px 12px;color:#fff;font-size:.72rem;
      font-family:-apple-system,sans-serif;display:flex;align-items:center;gap:5px;
    }
    .hand-dot{width:7px;height:7px;border-radius:50%;background:#374151;transition:background .2s}
    .hand-dot.active{background:#06b6d4;box-shadow:0 0 6px #06b6d4}
    .hud-right{display:flex;gap:8px;pointer-events:all}
    .hud-btn{
      cursor:pointer;background:rgba(10,10,26,.65);backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,.1);border-radius:20px;
      padding:6px 12px;color:#fff;font-size:.72rem;
      font-family:-apple-system,sans-serif;white-space:nowrap;
    }
  </style>
</head>
<body>

<div id="portrait-lock">
  <div class="p-icon">üì±</div>
  <div class="p-title">–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω</div>
  <div class="p-sub">Mobile XR —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ</div>
</div>

<div id="loading-screen">
  <div class="loader-logo">ü•Ω</div>
  <div class="loader-title">Mobile XR</div>
  <div class="loader-sub">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
  <div class="loader-bar"><div class="loader-fill" id="load-progress"></div></div>
</div>

<div id="update-banner">
  <span>üÜï –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!</span>
  <button id="update-btn">–û–±–Ω–æ–≤–∏—Ç—å</button>
  <button id="dismiss-btn">‚úï</button>
</div>

<div id="hud">
  <div class="hud-badge">
    <div class="hand-dot" id="left-dot"></div>–õ–µ–≤
    <div class="hand-dot" id="right-dot" style="margin-left:4px"></div>–ü—Ä
  </div>
  <div class="hud-right">
    <button class="hud-btn" id="fullscreen-btn">‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
    <button class="hud-btn" id="camera-btn">üì∑ –ö–∞–º–µ—Ä–∞</button>
    <button class="hud-btn" id="stereo-toggle">üëì VR</button>
  </div>
</div>

<div id="app"></div>

<script>
// Landscape-only
function checkOrientation(){
  const p = window.innerHeight > window.innerWidth
  document.getElementById('portrait-lock').style.display = p ? 'flex' : 'none'
}
checkOrientation()
window.addEventListener('resize', checkOrientation)
screen.orientation?.addEventListener('change', checkOrientation)

// Fullscreen / Hide UI
const fsBtn = document.getElementById('fullscreen-btn')
let hudHidden = false

function isIOS() {
  return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream
}

function isInStandaloneMode() {
  return window.matchMedia('(display-mode: standalone)').matches
    || window.navigator.standalone === true
}

async function tryFullscreen() {
  const el = document.documentElement
  try {
    if (el.requestFullscreen) {
      await el.requestFullscreen({ navigationUI: 'hide' })
      return true
    } else if (el.webkitRequestFullscreen) {
      await el.webkitRequestFullscreen()
      return true
    }
  } catch(e) {}
  return false
}

fsBtn.addEventListener('click', async () => {
  // –£–∂–µ –≤ fullscreen ‚Äî –≤—ã—Ö–æ–¥–∏–º
  if (document.fullscreenElement || document.webkitFullscreenElement) {
    if (document.exitFullscreen) document.exitFullscreen()
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen()
    return
  }

  // iOS Safari –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Fullscreen API ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª
  if (isIOS() && !isInStandaloneMode()) {
    const toast = document.createElement('div')
    toast.style.cssText = `
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:rgba(13,17,23,.97);color:#e6edf3;padding:20px 24px;border-radius:16px;
      font-family:-apple-system,sans-serif;font-size:.88rem;z-index:9999;
      border:1px solid rgba(99,102,241,.4);backdrop-filter:blur(16px);
      max-width:85vw;text-align:center;line-height:1.5;
    `
    toast.innerHTML = `
      <div style="font-size:1.5rem;margin-bottom:10px">üì≤</div>
      <div style="font-weight:700;margin-bottom:8px">–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω –Ω–∞ iOS</div>
      <div style="color:#9ca3af;font-size:.8rem">
        –ù–∞–∂–º–∏—Ç–µ <strong style="color:#6366f1">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</strong> ‚Üí
        <strong style="color:#6366f1">–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª</strong><br>
        –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç—Ç—É–¥–∞
      </div>
      <button onclick="this.parentElement.remove()" style="
        margin-top:14px;background:#6366f1;color:#fff;border:none;
        padding:8px 20px;border-radius:8px;font-size:.85rem;cursor:pointer;
      ">–ü–æ–Ω—è—Ç–Ω–æ</button>
    `
    document.body.appendChild(toast)
    return
  }

  // Android Chrome + –¥—Ä—É–≥–∏–µ ‚Äî –ø—Ä–æ–±—É–µ–º –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
  const ok = await tryFullscreen()
  if (!ok) {
    // Fallback: —Å–∫—Ä—ã–≤–∞–µ–º HUD –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    hudHidden = !hudHidden
    const hud = document.getElementById('hud')
    hud.style.opacity = hudHidden ? '0' : '1'
    hud.style.pointerEvents = hudHidden ? 'none' : 'auto'
    fsBtn.style.opacity = '1'
    fsBtn.style.pointerEvents = 'auto'
    if (hudHidden) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ —É–≥–ª—É
      fsBtn.textContent = '‚õ∂ –ü–æ–∫–∞–∑–∞—Ç—å UI'
      fsBtn.style.position = 'fixed'
      fsBtn.style.top = '8px'
      fsBtn.style.right = '8px'
    } else {
      fsBtn.textContent = '‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω'
      fsBtn.style.position = ''
      fsBtn.style.top = ''
      fsBtn.style.right = ''
    }
  }
})

document.addEventListener('fullscreenchange', () => {
  fsBtn.textContent = (document.fullscreenElement || document.webkitFullscreenElement)
    ? '‚úï –í—ã–π—Ç–∏' : '‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω'
})
document.addEventListener('webkitfullscreenchange', () => {
  fsBtn.textContent = (document.fullscreenElement || document.webkitFullscreenElement)
    ? '‚úï –í—ã–π—Ç–∏' : '‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω'
})
</script>

<script type="module" src="/src/main.ts"></script>
</body>
</html>
